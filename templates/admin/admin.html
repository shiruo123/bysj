{% load static %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">
    <title>管理员</title>
</head>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<body>
<div class="admin" style="margin: 0 auto;float: left">
    <div class="admin-top">预防电信网络诈骗在线考试后台</div>
    <div class="admin-left">
        <button style="background-color: #7abaff" id="b1" onclick="b_click(1)">科目管理</button>
        <button id="b2" onclick="b_click(2)">用户管理</button>
        <button id="b3" onclick="b_click(3)">考题管理</button>
        <button id="b4" onclick="b_click(4)">题库管理</button>
        <button id="b7" onclick="b_click(7)">评论管理</button>
        <button><a href="../" style="width: 200px">返回主页</a></button>
    </div>
    <div class="admin-right">
        <div class="admin-right-body">
            <div class="body-table">
                <div id="table1">
                    <table class="table1" id="{{ kemu|length|add:1 }}3" >
                        <tr>
                            <td nowrap="nowrap">ID</td>
                            <td nowrap="nowrap">标题</td>
                            <td nowrap="nowrap">其它</td>
                            <td nowrap="nowrap">封面图片</td>
                            <td nowrap="nowrap">修改</td>
                            <td nowrap="nowrap">删除</td>
                        </tr>
                        {% for sh in kemu %}
                            <tr id="1{{ sh.id }}_tr">
                            <td nowrap="nowrap">{{ forloop.counter }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table1_t">{{ sh.a }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table1_t">{{ sh.other }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table1_t">{{ sh.img }}</td>
                            <td nowrap="nowrap"><input id="{{ forloop.counter }}_table1_udt" type="button" onclick="update_data(this, [1, '{{ sh.id }}'])" value="修改"></td>
                            <td nowrap="nowrap"><input type="button" onclick="delete_data(1, '{{ sh.id }}')" value="删除"></td>
                            </tr>
                        {% endfor %}
                    </table>
                    <input type="button" style="width: 200px;height: 50px;margin-left: 390px" value="增加" onclick="create_data(this, 'table1')">
                </div>
                <div id="table2" style="display: none">
                    <table class="table2" id="{{ user|length|add:1 }}2">
                        <tr>
                            <td nowrap="nowrap">ID</td>
                            <td nowrap="nowrap">账号</td>
                            <td nowrap="nowrap">密码</td>
                            <td nowrap="nowrap">修改</td>
                            <td nowrap="nowrap">删除</td>
                        </tr>
                        {% for us in user %}
                            <tr id="2{{ us.id }}_tr">
                            <td nowrap="nowrap">{{ forloop.counter }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table2_t">{{ us.user }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table2_t">{{ us.password }}</td>
                            <td nowrap="nowrap"><input type="button" id="{{ forloop.counter }}_table2_upd" onclick="update_data(this, [2, '{{ us.id }}'])" value="修改"></td>
                            <td nowrap="nowrap"><input type="button" onclick="delete_data(2, '{{ us.id }}')" value="删除"></td>
                            </tr>
                            {% if forloop.last %}

                            {% endif %}
                        {% endfor %}
                    </table>
                    <input type="button" style="width: 200px;height: 50px;margin-left: 390px" value="增加" onclick="create_data(this, 'table2')">
                </div>
                <div id="table3" style="display: none">
                    <table class="table3">
                        <tr>
                            <td nowrap="nowrap">序号</td>
                            <td nowrap="nowrap">标题</td>
                            <td nowrap="nowrap">题库管理</td>
                        </tr>
                        {% for km in kemu %}
                            <tr id="3{{ km.id }}_tr">
                            <td nowrap="nowrap">{{ forloop.counter }}</td>
                            <td nowrap="nowrap">{{ km.a }}</td>
                            <td nowrap="nowrap"><input type="button" id="{{ forloop.counter }}_table3_upd" onclick="tiku_guanli(this, [3, '{{ km.id }}'])" value="管理"></td>
                            </tr>
                        {% endfor %}
                    </table>
                </div>
                <div id="table4" class="body-right-table4" style="display: none">
                    <table class="table6" id="{{ tiku|length|add:1 }}6">
                        <tr>
                            <td nowrap="nowrap">ID</td>
                            <td nowrap="nowrap">题目</td>
                            <td nowrap="nowrap">A</td>
                            <td nowrap="nowrap">B</td>
                            <td nowrap="nowrap">C</td>
                            <td nowrap="nowrap">D</td>
                            <td nowrap="nowrap">答案</td>
                            <td nowrap="nowrap">修改</td>
                            <td nowrap="nowrap">删除</td>
                        </tr>
                        {% for tk in tiku %}
                            <tr id="6{{ tk.id }}_tr">
                            <td nowrap="nowrap">{{ forloop.counter }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table6_t">{{ tk.t }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table6_t">{{ tk.a }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table6_t">{{ tk.b }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table6_t">{{ tk.c }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table6_t">{{ tk.d }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table6_t">{{ tk.daan }}</td>
                            <td nowrap="nowrap"><input type="button" id="{{ forloop.counter }}_table6_upd" onclick="update_data(this, [4, '{{ tk.id }}'])" value="修改"></td>
                            <td nowrap="nowrap"><input type="button" onclick="delete_data(6, '{{ tk.id }}')" value="删除"></td>
                            </tr>
                        {% endfor %}
                    </table>
                    <input type="button" style="width: 200px;height: 50px;margin-left: 390px" value="增加" onclick="create_data(this, 'table6')">
                </div>
                <div id="table7" style="display: none">
                    <table class="table7" id="{{ lts|length|add:1 }}3" >
                        <tr>
                            <td nowrap="nowrap">ID</td>
                            <td nowrap="nowrap">用户</td>
                            <td nowrap="nowrap">标题</td>
                            <td nowrap="nowrap">文本</td>
                            <td nowrap="nowrap">时间</td>
                            <td nowrap="nowrap">修改</td>
                            <td nowrap="nowrap">删除</td>
                        </tr>
                        {% for lt in lts %}
                            <tr id="7{{ lt.id }}_tr">
                            <td nowrap="nowrap">{{ forloop.counter }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table7_t">{{ lt.key_UserAccount.user }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table7_t">{{ lt.title }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table7_t">{{ lt.text }}</td>
                            <td nowrap="nowrap" class="{{ forloop.counter }}_table7_t">{{ lt.date }}</td>
                            <td nowrap="nowrap"><input id="{{ forloop.counter }}_table7_udt" type="button" onclick="update_data(this, [7, '{{lt.id }}'])" value="修改"></td>
                            <td nowrap="nowrap"><input type="button" onclick="delete_data(7, '{{ lt.id }}')" value="删除"></td>
                            </tr>
                        {% endfor %}
                    </table>
                    <input type="button" style="width: 200px;height: 50px;margin-left: 390px" value="增加" onclick="create_data(this, 'table7')">
                </div>
            </div>
        </div>
    </div>
</div>
<div class="body-float" style="display: none" id="body-float">
    {% for tg in tgs %}
        <div class="{{ tg.0.key_KaoShi_b.id }}_tiku" style="display: none">
            <p style="color: red;font-size: 24px;margin:0;text-align: center">{{ tg.0.key_KaoShi_b.a }}</p>
            <table class="table4-{{ forloop.counter }}" id="{{ tg|length|add:1 }}6">
                <tr>
                    <td nowrap="nowrap">ID</td>
                    <td nowrap="nowrap">题目</td>
                    <td nowrap="nowrap">A</td>
                    <td nowrap="nowrap">B</td>
                    <td nowrap="nowrap">C</td>
                    <td nowrap="nowrap">D</td>
                    <td nowrap="nowrap">答案</td>
{#                    <td nowrap="nowrap">修改</td>#}
                    <td nowrap="nowrap">删除</td>
                </tr>
                {% for ti in tg %}
                    <tr id="4{{ ti.id }}_tr">
                    <td nowrap="nowrap">{{ forloop.counter }}</td>
                    <td nowrap="nowrap" class="{{ forloop.counter }}_table4_t">{{ ti.key_TiKu_a.t }}</td>
                    <td nowrap="nowrap" class="{{ forloop.counter }}_table4_t">{{ ti.key_TiKu_a.a }}</td>
                    <td nowrap="nowrap" class="{{ forloop.counter }}_table4_t">{{ ti.key_TiKu_a.b }}</td>
                    <td nowrap="nowrap" class="{{ forloop.counter }}_table4_t">{{ ti.key_TiKu_a.c }}</td>
                    <td nowrap="nowrap" class="{{ forloop.counter }}_table4_t">{{ ti.key_TiKu_a.d }}</td>
                    <td nowrap="nowrap" class="{{ forloop.counter }}_table4_t">{{ ti.key_TiKu_a.daan }}</td>
{#                    <td nowrap="nowrap"><input type="button" id="{{ forloop.counter }}_table4_upd" onclick="update_data(this, [4, '{{ ti.key_TiKu_a.id }}'])" value="修改"></td>#}
                    <td nowrap="nowrap"><input type="button" onclick="delete_data(4, '{{ ti.id }}')" value="删除"></td>
                    </tr>
                    {% if forloop.last %}
                    {% endif %}
                {% endfor %}
            </table>
            <input type="button" style="width: 200px;height: 50px;margin-left: 360px;float: left" value="增加" onclick="tiku_create('{{ tg.0.key_KaoShi_b.id }}')">
            <input type="button" style="width: 200px;height: 50px;margin-left: 20px;float: left" value="返回" onclick="fanhui('{{ tg.0.key_KaoShi_b.id }}_tiku')">
        </div>
    {% endfor %}
    <div class="table5" style="display: none">
        <table class="table5">
            <input type="button" style="width: 200px;height: 50px;margin-left: 470px;float: left" value="返回" onclick="fanhui('table5')">
            <tr>
                <td nowrap="nowrap">序号</td>
                <td nowrap="nowrap">题目</td>
                <td nowrap="nowrap">A</td>
                <td nowrap="nowrap">B</td>
                <td nowrap="nowrap">C</td>
                <td nowrap="nowrap">D</td>
                <td nowrap="nowrap">答案</td>
                <td nowrap="nowrap">增加</td>
            </tr>
            {% for tk in tiku %}
                <tr>
                    <td nowrap="nowrap">{{ tk.id }}</td>
                    <td nowrap="nowrap">{{ tk.t }}</td>
                    <td nowrap="nowrap">{{ tk.a }}</td>
                    <td nowrap="nowrap">{{ tk.b }}</td>
                    <td nowrap="nowrap">{{ tk.c }}</td>
                    <td nowrap="nowrap">{{ tk.d }}</td>
                    <td nowrap="nowrap">{{ tk.daan }}</td>
                    <td nowrap="nowrap"><input type="button" onclick="tiku_create_data('{{ tk.id }}')" value="增加"></td>
                </tr>
            {% endfor %}
        </table>
    </div>

</div>
</body>
</html>


<script>
    let update_is = false
    function b_click(id){
        const l = [1, 2, 3, 4, 7]
        for (let i = 0; i < l.length; i++) {
            const b = document.getElementById("b"+String(l[i]))
            const t = document.getElementById("table"+l[i])
            if (id===l[i]){
                b.style = 'background-color: #7abaff'
                t.style = 'display: block'
            }
            else{
                b.style = 'background-color: none'
                t.style = 'display: none'
            }
        }
    }
    function delete_data(b_id, b_b_id) {
        console.log(b_b_id)
        let data = {
            'b_id': b_id,
            'b_b_id': b_b_id,
        }
        $.ajax({
            url: 'admin/delete_data',
            type: 'get',
            traditional:true, {#传数组必备#}
            data: data,
            success: function (res) {
                alert('删除成功')
                const tr = document.getElementById(String(b_id)+b_b_id+"_tr")
                tr.style = 'display:none;'
            }
        })
    }
    function update_data(obj, list){
        let id_0 = ""
        let id_7 = ""
        if (isNaN(obj.id[1])===false) {
            id_0 = obj.id[0] + obj.id[1]
            id_7 = obj.id[8]
        }else {
            id_0 = obj.id[0]
            id_7 = obj.id[7]
        }
        if (obj.value ==="修改"){
            if (update_is){
                alert("请先完成上一次的修改")
            }else{
                let ts = document.getElementsByClassName(id_0+"_table"+id_7+"_t")
                console.log(ts)
                for (let i = 0; i < ts.length; i++) {
                    console.log(ts[i].innerHTML)
                    ts[i].contentEditable = "True";
                    ts[i].style = 'background-color: #f3f3f3'
                }
                obj.value = "确定"
                update_is = true
            }
        }
        else if (obj.value === "确定"){
            let ts = document.getElementsByClassName(id_0+"_table"+id_7+"_t")
            let ts_list = []
            for (let i = 0; i < ts.length; i++) {
                console.log(ts[i].innerHTML)
                ts_list.push(ts[i].innerHTML)
                ts[i].contentEditable = "False";
                ts[i].style = 'background-color: #ffffff'
            }
            update_is = false
            $.ajax({
                url: 'admin/update_data',
                type: 'get',
                traditional:true, {#传数组必备#}
                data: {
                    "b_id": list[0],
                    "b_b_id": list[1],
                    'datas': ts_list
                },
                success: function (res) {
                    console.log(res)
                    alert('修改成功')
                }
            })
            obj.value = "修改"
        }
    }
    function create_data(obj, classname){
        let tr = ""
        let id_0 = ""
        let id_1 = ""
        const table = document.getElementsByClassName(classname)[0]
        if (table.id.length === 3) {
            id_0 = table.id[0]+table.id[1]
            id_1 = table.id[2]
        }else {
            id_0 = table.id[0]
            id_1 = table.id[1]
        }
        if (obj.value === "增加"){
            for (let i = 0; i < parseInt(id_1); i++) {
                tr += "<td nowrap='nowrap' contentEditable='True' class='"+id_0+"_table"+classname[5]+"_t"+"' style='background-color: #ffffff'></td>"
            }
            table.innerHTML += "<tr><td nowrap='nowrap'>"+id_0+tr+"</td></tr>";
            obj.value = "确定"
        }else{
            let ts = document.getElementsByClassName(id_0+"_table"+classname[5]+"_t")
            let ts_list = []
            for (let i = 0; i < ts.length; i++) {
                if (ts[i].innerHTML === ""){
                    alert("请填写完！")
                    return
                }
                ts_list.push(ts[i].innerHTML)
            }
            $.ajax({
                url: 'admin/create_data',
                type: 'get',
                traditional:true, {#传数组必备#}
                data: {
                    "b_id": classname[5],
                    'datas': ts_list
                },
                success: function (res) {
                    obj.value = "增加"
                    table.id = String(parseInt(id_0)+1) + id_1
                    alert("添加成功！")
                    location.reload()
                }
            })
        }
    }
    function tiku_guanli(obj, tiku){
        const b = document.getElementById('body-float')
        const t = document.getElementsByClassName(tiku[1]+'_tiku')[0]
        b.style = 'display:block'
        t.style = 'display:block'
    }
    function fanhui(tiku_id){
        const b = document.getElementById('body-float')
        const t = document.getElementsByClassName(tiku_id)[0]
        b.style = 'display:none'
        t.style = 'display:none'
    }
    function tiku_create(kaoshi_id){
        const b = document.getElementById('body-float')
        const t = document.getElementsByClassName(kaoshi_id+"_tiku")[0]
        const table5 = document.getElementsByClassName('table5')[0]
        b.style = 'display: block;'
        table5.id = kaoshi_id+"table5"
        table5.style = 'display:block;'
        t.style = 'display:none'
    }
    function tiku_create_data(tiku_id){
        const t = document.getElementsByClassName('table5')[0]
        const datas = [tiku_id, t.id[0]]
        $.ajax({
            url:'admin/create_data',
            type:'get',
            traditional:true, {#传数组必备#}
            data: {
                'b_id': "5",
                "datas": datas
            },
            success: function (res) {
                    alert("添加成功！")
                    location.reload()
                }
        })
    }
</script>
